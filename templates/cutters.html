{% extends "base.html" %}
{% block content %}
<section class="page-header">
  <div>
    <h2>Реестр резцов</h2>
    <p>Обзор текущего статуса всех экземпляров резцов.</p>
  </div>
  <form method="post" action="{{ url_for('seed_data') }}">
    <button type="submit" class="secondary">Создать тестовые данные</button>
  </form>
</section>

<form class="filters" method="get" action="{{ url_for('cutters') }}">
  <input type="text" name="q" value="{{ search }}" placeholder="Поиск по номеру">
  <select name="status">
    <option value="">Все статусы</option>
    <option value="warehouse" {% if status == 'warehouse' %}selected{% endif %}>Склад</option>
    <option value="in_work" {% if status == 'in_work' %}selected{% endif %}>В работе</option>
    <option value="awaiting_resharpen" {% if status == 'awaiting_resharpen' %}selected{% endif %}>Ожидает переточку</option>
    <option value="in_resharpen" {% if status == 'in_resharpen' %}selected{% endif %}>На переточке</option>
    <option value="scrapped" {% if status == 'scrapped' %}selected{% endif %}>Списан</option>
  </select>
  <button type="submit">Применить</button>
</form>

<table>
  <thead>
    <tr>
      <th>Сокр. номер</th>
      <th>Статус / местонахождение</th>
      <th>Текущий радиус</th>
      <th>В эксплуатации с</th>
      <th>Действия</th>
    </tr>
  </thead>
  <tbody>
  {% for cutter in cutters %}
    <tr>
      <td><a href="{{ url_for('cutter_detail', cutter_id=cutter.id) }}">{{ cutter.serial_short }}</a></td>
      <td>
        <strong>{{ cutter.status }}</strong>
        <div class="muted">{{ location_label(cutter) }}</div>
      </td>
      <td>{{ cutter.radius_current }}</td>
      <td>{{ cutter.commissioned_at.date() }}</td>
      <td>
        <form method="post" action="{{ url_for('scrap_cutter', cutter_id=cutter.id) }}">
          <input type="text" name="scrap_reason" placeholder="Причина списания">
          <button type="submit" class="danger">Списать</button>
        </form>
      </td>
    </tr>
  {% else %}
    <tr>
      <td colspan="5" class="muted">Резцы не найдены.</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
